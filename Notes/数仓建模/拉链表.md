表中记录了**每条数据的生命周期** ，即开始时间和结束时间，**可以查询当前最新状态和某个时间点的历史记录，但又不需要维护一个每日全量表，节省了存储空间** 。开始时间是新加入时间或更新时间，结束日期即失效日期，当前有效的记录，该列的值为9999-99-99。

拉链表最常用来对用户信息表的历史变动做记录，其特点是：

* 大表：记录多，字段多
* 数据缓慢更新：会修改记录或新增记录，但频率和比例不大，如1亿条数据一天只有100万有更新
* 需要查看某一时间切片的历史信息：如某一个id的历史用户名

拉链表解决了只维护一份最新数据无法查看历史记录，每日维护一个全量表有浪费空间的问题。

加入为MySQL中的user表，在Hive中维护一张user_his拉链表，粒度为天，需要的准备：

* 昨日的user_his全量数据，初始的拉链表为第一天user的全量数据，并加上start_date=dt, end_date='9999-99-99'两个字段
* 一张user的每日更新表或增量表

更新表的获取途径：

* 最好user表自带了创建日期和更新日期
* 使用Canal监听MySQL数变化，最后合并每日变化，得到每日最终状态
* 如果能获得每日的全量数据，对两日的全量数据使用md5(concat(所有可能改变的字段))，判断变化
* 找到每日的变更流水表

拉链表的生成过程：详见电商离线数仓文档

假设获得了每日更新表user_update

* 首先user_his left join user_update on uh.id = uu.id，然后对于uh的每一条数据，判断是否正要被更新，即uu.id is not null and uh.end_date='9999-99-99'，满足条件则将end_date置为date_sub(dt,-1)，否则，要么uu.id为hull，即未更新，要么uh.end_date早就过时了，不用改动。
* 然后从user_update获取当天的全部数据，不管是新增还是修改，都增加start_date=dt, end_date='9999-99-99'两个字段。
* 前两步结果union起来。

拉链表和流水表：流水表存放的是一个用户的变更记录，比如在一张流水表中，一天的数据中，会存放一个用户的每条修改记录，但是在拉链表中只有一条记录。这是拉链表设计时需要注意的一个粒度问题。我们当然也可以设置的粒度更小一些，一般按天就足够。

性能优化：拉链表存放太久，查询性能也会变低，在某些查询引擎中可以对start_date和end_date做索引，或者是只保留几个月的拉链表。

其他全量表、增量表、快照表、切片表

全量表：保存用户所有的数据（包括新增与历史数据）

增量表：只保留当前新增的数据

快照表：按日分区，记录截止数据日期的全量数据

切片表：切片表根据基础表，往往只反映某一个维度的相应数据。其表结构与基础表结构相同，但数据往往只有某一维度，或者某一个事实条件的数据