### 用一条SQL语句查询出每门课都大于80分的学生姓名。

创建表并初始化数据

```
create table Grade
(
   Name nvarchar(20),
   Course nvarchar(10),
   Score int
);

insert Grade values('张三','语文',80);
insert Grade values('张三','数学',75);
insert Grade values('李四','语文',66);
insert Grade values('李四','数学',91);
insert Grade values('王五','语文',84);
insert Grade values('王五','数学',100);
insert Grade values('王五','英语',97);
insert Grade values('杨六','英语',86);
insert Grade values('杨六','数学',93);
```

期望的结果为：王五和杨六。

**方法一  not in +子查询 :**

**思路：**采用逆向思维。求三门成绩都大于80的人，也可以是先查出有成绩小于80 的人，再除去这些人不就是每门成绩都大于80的人了么？

**具体办法：**先扫描表，查出有成绩小于80的人的姓名，然后再次扫描表，用not in 或not exists 方法。

**点评：**此方法采用逆向思维，能快速写出高效且简单的 SQL语句。

```mysql
select distinct Name from Grade  where Name not in (select distinct Name from Grade where Score<=80);
```

或

```sql
select distinct Name from Grade a where not exists (select Name from Grade b where b.Score<=80 and b.Name=a.Name);
/*exists 详解
取出 外表第一条数据 ，然后与内表  根据连接条件 ，
形成一条或多条数据，判断这些生成的数据中是否存在
或者是不存在符合where条件的 。结果为true的那条外表
记录旧被查询出来！

实例过程： 取出外表的第一条记录， 
和内表通过姓名条件连接，这时候产生2两记录，
根据 not exists是判断不存在。 条件是 score<80 .
而这两条记录存在一条记录小于80，所以于not exists 不符合，
该条记录不被查出。
*/
```

**方法二 group by +聚合函数：**

```sql
select Name from Grade group by Name having min(score)>80;
```

　  或另外一种方法适合学生所考的科目都相同的情况，但是此方法在这里无效。

```sql
select Name from Grade where Score>80 group by Name having count(Score)=3;
```

　下面的几种方法也可以解题，但是不怎么好。

方法三：

**思路：**如果能获得一张表，由学生姓名，语文成绩，数学成绩，英语成绩的表，剩下的就是在WHERE条件中筛选及可以获得想要的结果。

**具体办法：**通过自连接的办法，以“姓名”为连接条件，自连接三次，便可以获得包含又姓名和三门课程成绩的数据行。虽然可以得到想要的数据列。但会有很多冗余重复列！

**点评：**此方法是根据题目，依题解题，中规中矩！ 不过多张表连接非常耗费时间。而且SQL语句也比较复杂，需要注意事项很多。倒是可以用于查询某几门课成绩大于80的学生。

```sql
SELECT  D.name  FROM (
SELECT  S.name,S.score AS ITEM1,S1.score AS ITEM2,S2.score AS ITEM3
FROM Student S 
inner join Student S1 on S.name = S1.name and S.course <> S1.course
inner join Student S2 on S.name = S2.name and S.course <> S2.course
WHERE S.score>=80 and S1.score>=80 and S2.score>=80
) D 
GROUP BY D.name ;
```

**易错点：**内表的 score字段必须要取别名，否则会报错 。

方法四：

```mysql
select distinct a.Name from Grade a left join Grade b on a.Name=b.Name and b.Score<=80 where b.Name is null;
```

### 第2题

有表A，结构如下：

```
p_ID  p_Num  s_id 
   1   10   01 
   1   12   02 
   2   8   01 
   3   11   01 
   3   8   03
```

其中：p_ID为产品ID，p_Num为产品库存量，s_id为仓库ID。请用SQL语句实现将上表中的数据合并，合并后的数据为：

```
 p_ID s1_id s2_id  s3_id 
 1   10  12   0 
 2   8   0   0 
 3   11   0   8
```

其中：s1_id为仓库1的库存量，s2_id为仓库2的库存量，s3_id为仓库3的库存量。如果该产品在某仓库中无库存量，那么就是0代替。

```sql
select
   p_ID, 
   sum(if(s_id = '01', p_Num, 0)) as s1_id, 
   sum(if(s_id = '02', p_Num, 0)) as s2_id, 
   sum(if(s_id = '03', p_Num, 0)) as s3_id
from A
group by p_ID;
```